<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>REX Planning A350 – Check A (Effectifs détaillés)</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --muted: #1f2937;
      --text: #e5e7eb;
      --accent: #60a5fa;
      --ok: #22c55e;
      --warn: #f59e0b;
      --bad: #ef4444;
    }
    * { box-sizing: border-box }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font: 14px/1.4 system-ui, Segoe UI, Roboto;
    }
    header {
      display: flex;
      gap: 12px;
      align-items: center;
      padding: 14px 18px;
      border-bottom: 1px solid #1f2937;
      background: rgba(15,23,42,.9);
      backdrop-filter: blur(8px);
      position: sticky;
      top: 0;
    }
    h1 { font-size: 16px; font-weight: 700; margin: 0; }
    .wrap { padding: 20px; max-width: 1000px; margin: auto; }
    .panel {
      background: var(--panel);
      border: 1px solid #1f2937;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #1e293b;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #1e293b;
    }
    input {
      width: 60px;
      text-align: center;
      background: #0b1222;
      border: 1px solid #223050;
      color: var(--text);
      border-radius: 6px;
      padding: 4px;
    }
    .total-row {
      background: #0b1222;
      font-weight: bold;
    }
    .delta {
      margin-top: 12px;
      font-size: 13px;
    }
    .btn {
      background: #11345a;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <h1>REX Planning A350 – Check A</h1>
    <button class="btn" id="exportBtn">Exporter JSON</button>
    <label class="btn" for="importFile">Importer JSON</label>
    <input type="file" id="importFile" accept="application/json" style="display:none" />
  </header>

  <div class="wrap">
    <div class="panel">
      <h2>Effectifs par vacation</h2>
      <table id="effectifTable">
        <thead>
          <tr>
            <th>Vacation</th>
            <th>Eff. demandé total</th>
            <th>CME dem.</th>
            <th>EIR dem.</th>
            <th>Leader dem.</th>
            <th>Eff. réel total</th>
            <th>CME réel</th>
            <th>EIR réel</th>
            <th>Leader réel</th>
          </tr>
        </thead>
        <tbody>
          <tr data-vac="matin">
            <td>Matin</td>
            <td class="auto dem"></td>
            <td><input type="number" min="0" class="cmeDem"></td>
            <td><input type="number" min="0" class="eirDem"></td>
            <td><input type="number" min="0" class="leadDem"></td>
            <td class="auto real"></td>
            <td><input type="number" min="0" class="cmeReal"></td>
            <td><input type="number" min="0" class="eirReal"></td>
            <td><input type="number" min="0" class="leadReal"></td>
          </tr>
          <tr data-vac="soir">
            <td>Soir</td>
            <td class="auto dem"></td>
            <td><input type="number" min="0" class="cmeDem"></td>
            <td><input type="number" min="0" class="eirDem"></td>
            <td><input type="number" min="0" class="leadDem"></td>
            <td class="auto real"></td>
            <td><input type="number" min="0" class="cmeReal"></td>
            <td><input type="number" min="0" class="eirReal"></td>
            <td><input type="number" min="0" class="leadReal"></td>
          </tr>
          <tr data-vac="nuit">
            <td>Nuit</td>
            <td class="auto dem"></td>
            <td><input type="number" min="0" class="cmeDem"></td>
            <td><input type="number" min="0" class="eirDem"></td>
            <td><input type="number" min="0" class="leadDem"></td>
            <td class="auto real"></td>
            <td><input type="number" min="0" class="cmeReal"></td>
            <td><input type="number" min="0" class="eirReal"></td>
            <td><input type="number" min="0" class="leadReal"></td>
          </tr>
        </tbody>
        <tfoot>
          <tr class="total-row">
            <td>Total général</td>
            <td id="totDem"></td>
            <td id="totCmeDem"></td>
            <td id="totEirDem"></td>
            <td id="totLeadDem"></td>
            <td id="totReal"></td>
            <td id="totCmeReal"></td>
            <td id="totEirReal"></td>
            <td id="totLeadReal"></td>
          </tr>
        </tfoot>
      </table>
      <div class="delta" id="deltaInfo">Δ Effectif total : 0 | Δ HMO : 0h</div>
    </div>
  </div>

  <script>
    const table = document.getElementById("effectifTable");
    const deltaInfo = document.getElementById("deltaInfo");
    const inputs = table.querySelectorAll("input");

    function calc() {
      let totalDem = 0, totalReal = 0;
      let totCmeDem = 0, totCmeReal = 0, totEirDem = 0, totEirReal = 0, totLeadDem = 0, totLeadReal = 0;

      table.querySelectorAll("tbody tr").forEach(tr => {
        const cmeDem = +tr.querySelector(".cmeDem").value || 0;
        const eirDem = +tr.querySelector(".eirDem").value || 0;
        const leadDem = +tr.querySelector(".leadDem").value || 0;
        const cmeReal = +tr.querySelector(".cmeReal").value || 0;
        const eirReal = +tr.querySelector(".eirReal").value || 0;
        const leadReal = +tr.querySelector(".leadReal").value || 0;

        const demTotal = cmeDem + eirDem + leadDem;
        const realTotal = cmeReal + eirReal + leadReal;

        tr.querySelector(".auto.dem").textContent = demTotal;
        tr.querySelector(".auto.real").textContent = realTotal;

        totalDem += demTotal;
        totalReal += realTotal;

        totCmeDem += cmeDem; totCmeReal += cmeReal;
        totEirDem += eirDem; totEirReal += eirReal;
        totLeadDem += leadDem; totLeadReal += leadReal;
      });

      document.getElementById("totDem").textContent = totalDem;
      document.getElementById("totReal").textContent = totalReal;
      document.getElementById("totCmeDem").textContent = totCmeDem;
      document.getElementById("totCmeReal").textContent = totCmeReal;
      document.getElementById("totEirDem").textContent = totEirDem;
      document.getElementById("totEirReal").textContent = totEirReal;
      document.getElementById("totLeadDem").textContent = totLeadDem;
      document.getElementById("totLeadReal").textContent = totLeadReal;

      const delta = totalReal - totalDem;
      deltaInfo.textContent = `Δ Effectif total : ${delta >= 0 ? "+" : ""}${delta} | Δ HMO : ${Math.round(delta*0.5)}h`;
    }

    inputs.forEach(inp => inp.addEventListener("input", calc));
    window.addEventListener("load", calc);
  </script>
</body>
</html>
